\documentclass[french]{article}
\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[a4paper]{geometry}
\usepackage{babel}
\usepackage{fancyhdr}
\usepackage[hidelinks]{hyperref}
\usepackage{graphicx}
\usepackage{geometry}
\usepackage{pgfgantt}
\usepackage{listings}
\geometry{bottom=3cm, top=3cm}
\hypersetup{colorlinks=true}



\makeatletter
\def\thickhrulefill{\leavevmode \leaders \hrule height 1pt\hfill \kern \z@}
\def\maketitle{%
  \null
  \thispagestyle{empty}%
  \vskip 1cm
  \begin{center}
    \Huge \strut \@title \par
    \large \strut Travail de semestre
  \end{center}
  \ifhmode\par\fi
  \hbox to \hsize{\hfill
    \vrule height 2pt width.5\hsize
    \hfill}%
  \begin{center}
  	\normalfont\large CFPT Informatique\par
    \normalfont\large\@author\par
    \normalfont T.IS-E2A
  \end{center}
%IMG A METTRE ICI
  \begin{center}
    \normalfont\large 2014 - 2015
  \end{center}
  \par
  \vfil
  \vfil
  \null
  \cleardoublepage
  }
\input{./inc_lst_csharp.tex}



\makeatother

\title{Twitch Alert}
\author{Jean-Philippe Froelicher}
\date{}

\pagestyle{fancy}
\lhead{Twitch Alert}
\lfoot{Jean-Philippe Froelicher}
\rfoot{\today}
\renewcommand{\footrulewidth}{0.4pt}


\begin{document}
\includegraphics[width=0.9\textwidth]{img/Logo.png}
\maketitle

\newpage
\tableofcontents
\newpage


\part{Résumé}
\section{Fr}
Le but de ce projet est de créer une application windows en C\#. Cette application doit notifier l'utilisateur des nouvelles diffusions de flux vidéo en direct de Twitch grâce à un petit pop-up. Elle doit également offrir une gestion des notifications et des "Suivis" Twitch. 
L'application est composée de trois vues : une vue principale pour la navigation entre les différents streams; une vue de connexion pour la connexion au compte Twitch; une vue des détails d'une chaîne Twitch. Le flux vidéo est accessible via la vue des détails d'une chaîne.
Afin d'obtenir les informations dont j'avais besoin, j'ai utilisé l'API Twitch qui utilise la librairie cURL pour l'envoi de requêtes HTML. Pour l'aspect graphique de la notification, j'ai utilisé un composant trouvé sur le web nommé "Popup Notifier", je l'ai modifié graphiquement pour qu'il convienne à mon application.
Je n'ai malheureusement pas pu faire la gestion de notification mais l'application est tout de même fonctionnelle.

\section{En}
The objectives  of this project is to create a Windows application in C\#. This application must notify the user of new online streams of Twitch with a litle pop-up. This application must too provide a management of notifications and follows Twitch.
The application is composed by three views : main view for the navigation between the streams; login view for the connexion of the Twitch account; details view of channel. The stream is accessible since then the details view of channel.
To obtain the informations whose i needed, i use the Twitch API who use the cURL library for send a HTML request. For the graphic aspect of the notification, i use a componant find in the web named "Popup Notifier", i have modify graphicaly for my application.
I have unfortunately can't realise the management notification but the application run.

\newpage
\part{Cahier des charges}
\section{Initial}
\subsection{Titre du projet}
Twitch \textit{Alert}
\subsection{Objectifs du projet}
Créer une application de notification(alerte) pour la plateforme de diffusion de \textit{streaming} \textbf{TWITCH}. \\
Apprentissage et prise en main de l'API\footnote{Application Programming Interface} Twitch.
\subsection{Description du projet}

\noindent
\textbf{Glossaire :} \\
stream (n.m) : Flux vidéo.\\
streamer (v.) : L'action de diffuser du flux vidéo.\\
streaming (n.m) : Diffusion de vidéos en continu.\\
streameur (n.m) : Personne diffusant une vidéo en continu.\\
Twitch : Site permettant à n'importe qui de diffuser du flux vidéo, chaque utilisateur a une chaine Twitch permettant de diffuser du flux vidéo. \\
Chaîne Twitch : Un utilisateur Twitch a forcément une chaine Twitch qu'il utilise que lorsqu'il diffuse du flux vidéo.

\noindent
\textbf{Général :} \\
Une vue principale qui permet de configurer les différentes notifications et alertes pour chaque flux vidéo (stream). \\
L'application tourne en tâche de fond, c'est-à-dire qu'une icône apparait dans la barre de tâche lorsque l'on réduit la fenêtre de l'application. Pour y accéder on clique sur l'icône de la barre de tâche.\\
Une notification est représentée sous forme de \textit{pop-up}(petite fenêtre) qui apparait en bas à droite de l'écran principal, un petit son est émis lorsque la notification apparait si l'utilisateur ne la voit pas.
\newpage
\begin{figure}[h]
\center
\textbf{Twitch}
\includegraphics[width=0.6\textwidth]{img/schemaTwitch.png}
\caption{Schema Twitch}
\label{Schema Twitch}
\end{figure}
\begin{itemize}
\item La plateforme Twitch permet de suivre des streameurs "indépendants", actuellement, lorsqu'un streameur commence son stream, une notification est envoyée par e-mail. Le but est de pouvoir saisir le nom Twitch du streameur, et lorsque il commence son stream, mon application notifie l'utilisateur.
\item Pouvoir regarder le stream d'un utilisateur Twitch.
\item Gestion des notification pour chaque chaine Twitch.
\item Gestion des plages horaires de notifications pour chaque chaine Twitch
\end{itemize}

\newpage
\part{Étude d'opportunité}
\section{Introduction au projet}
Le but de ce projet est de réaliser une application de notification pour la plateforme de diffusion de streaming Twitch ainsi que toute la gestion de ses notifications.

\subsection{Twitch}
Twitch est une plateforme de diffusion de streaming et de VOD\footnote{\textit{Video On Demand}} de jeux vidéo créée en 2011.
C'est la plateforme numéro un pour les amateurs de streaming, toutes personnes voulant commencer dans ce monde est quasiment obligé de passer par Twitch.\\
La plateforme donne la possibilité de pouvoir transmettre du flux vidéo sur la chaîne Twitch de l'utilisateur en question ainsi, chaque utilisateur peut devenir s'il le souhaite une sorte de mini télévision qui diffuse du flux vidéo lorsqu'il veut.\\
Les utilisateurs qui diffusent du flux vidéo sont rémunéré grâce aux dons que les spectateurs leur offrent via un service de Twitch.
\subsubsection{Chaîne}
Une chaîne Twitch offre une multitude de possibilités pour l'utilisateur spectateur, effectivement une chaîne n'est pas simplement un flux vidéo.
Il y a la fonction "Suivre" une chaîne Twitch, qui permet aux spectateurs de pouvoir être tenu au courant via e-mail, mais aussi d'accéder plus rapidement à la chaîne en question.
Il y a également une fonction "S'abonner" qui est payante, le prix varie selon la chaîne. En revanche, cette fonction offre quelques avantages pas très significatifs, car l'abonnement sert surtout à soutenir financièrement directement la chaîne Twitch.
Une chaîne contient également un \textit{chat} permettant à la communauté de cette chaîne de discuter sur le flux vidéo actuel et également avoir une interaction avec l'utilisateur qui diffuse son flux vidéo.
\subsubsection{Team}
Une \textit{team} Twitch est un groupe de chaîne Twitch, la notion de team permet uniquement de retrouver les différentes chaînes d'un groupe de streaming, ou d'une team professionnelle de jeu etc...\\

\subsubsection{Suivis (Following)}
Un utilisateur Twitch a la possibilité de suivre une chaîne Twitch, le principe du "suivis" est que chaque fois que la chaîne commence à diffuser du flux vidéo, les utilisateurs qui suivent cette chaîne sont prévenus via e-mail.

\subsection{Pourquoi avoir choisi ce sujet ?}
J'ai choisi ce sujet parce que je porte un réel intérêt au monde du streaming. En effet, je regarde régulièrement des streams sur des chaînes de la plateforme de streaming Twitch. N'étant jamais au courant de quel streameur est en train de diffuser à moment donné, j'ai donc pensé à une application qui notifie et informe l'utilisateur des différents streams en cours.\\
De plus, le monde du streaming est tout nouveau ce qui accentue mon intérêt sur le sujet.
 
\subsection{Pourquoi une application de bureau ?}
Au départ, je voulais créer une application mobile, ce qui augmente l'intérêt de l'application, mais le temps laissé à disposition n'est pas assez conséquent et donc étant novice dans la programmation mobile, j'ai décidé de créer une application de bureau que je pourrai peut-être porter plus tard sur mobile.
\subsection{Pourquoi C\#?}
J'ai choisi de développer mon application en C\#, car c'est le langage que je connais le mieux actuellement, et je pense également que c'est le langage qui est le plus adapté pour l'application à réaliser, car elle est sur Windows.

\section{Analyse de l'existant}
\subsection{Existant}
Étant donner que le streaming est un monde nouveau il y a peu d'application sur ce sujets, en effet les seules applications sont :
\begin{itemize}
\item \textbf{Twitch} : Application mobile officielle de la plateforme de streaming Twitch
\item \textbf{Twitch now} : Application Google Chrome
\item \textbf{Twitch Notifier} : Application Google Chrome
\end{itemize}
\subsection{Critique de l'existant}
\noindent
\textbf{Twitch} : Cette application sert à accéder à la plateforme de streaming Twitch. En effet, c'est l'application officielle, il y a donc la possibilité de visionner n'importe quelles chaînes Twitch, la possibilité de se connecter à la plateforme pour voir toutes les chaînes que l'utilisateur suit.
\textbf{Twitch now} : Cette application permet à l'utilisateur de naviguer dans les différents streams de Twitch, c'est une application Google Chrome de Twitch, elle permet de naviguer dans Twitch sans aller sur le site. Le système de suivi est celui de Twitch, c'est-à-dire que lorsque dans l'application on suit une chaîne Twitch, dans le compte Twitch de l'utilisateur la chaîne s'ajoute également dans la liste de suivi. \\
\textbf{Twitch notifier} : Cette application permet à l'utilisateur d'être notifié lorsqu'un stream commence. C'est une application pour Google Chrome donc inutilisable si l'utilisateur n'utilise pas Google Chrome. C'est une application qui s'approche beaucoup de celle que je réalise car on peut saisir, dans l'application, la chaîne Twitch d'un streameur et lorsque ce streameur commence à streamer, une notification s'affiche sous forme de pop-up.\\
La lecture des flux vidéos se fait directement sur le site Twitch.

\newpage
\part{Analyse fonctionnelle}
\section{Gestion des chaînes}
La gestion des chaînes Twitch reprend dans les grandes lignes les différentes fonctions de Twitch :
\begin{itemize}
\item Suivre / Ne plus suivre une chaîne
\item Recherche de streams par nom
\item Recherche de streams par popularité (nombre de spectateurs)
\item Affichage du flux vidéo
\item Notification par e-mail lorsqu'une diffusion commence
\end{itemize}
\noindent

La gestion des chaînes de mon application a pour but de gérer les différentes chaînes. Elle se compose comme ceci :
\begin{itemize}
\item Liste des chaînes en ligne et hors-ligne
\item Détail d'une chaîne Twitch
\end{itemize}
\noindent
La liste des chaînes en ligne affiche les chaînes que l'utilisateur suit et qui sont actuellement en ligne, c'est-à-dire que la chaîne diffuse du flux vidéo en direct.\\
La liste des chaînes hors-ligne affiche les chaînes que l'utilisateur suit et qui sont actuellement hors-ligne. Les différentes options de configuration de chaque chaîne sont accessible depuis ces liste. \\
Le détail d'une chaîne Twitch consiste à afficher toutes les informations concernant une chaîne Twitch, en effet, c'est depuis là que l'utilisateur peut visualiser le stream de la chaîne, toutes les fonctions de bases de Twitch pour une chaîne sont reprisent ici.

\section{Recherche d'une chaîne}
Il y a différente manière de rechercher une chaîne sur Twitch :
\begin{itemize}
\item Recherche par nom de chaine
\item Recherche par jeux
\item Recherche par popularité
\end{itemize}
L'application reprend les mêmes filtres que le site Twitch.

\section{Suivre une chaîne}
Suivre une chaîne Twitch permet d'être notifié par e-mail lorsque la chaîne commence une diffusion en direct. La fonction "Suivre" de mon application permet de suivre une chaîne et ainsi d'être notifié lorsqu'elle commence une nouvelle diffusion en direct.
Pour utiliser cette fonction, il faut obligatoirement être connecté à Twitch.
 
\section{Gestion des notifications}
La gestion des notifications est très simple, les notifications sont activées pour tout les streams que l'utilisateur suit. Je pars du principe que lorsqu'un utilisateur suit une chaîne, il veut être de toute manière informé d'un début de diffusion. 
Lorsqu'une diffusion commence, une notification apparaît sur l'écran en bas à droite avec certaines informations sur le stream.

\newpage
\section{Interface homme-machine}
\subsection{Vue principale}
La vue principale permet à l'utilisateur de se connecter à Twitch et ainsi de s'informer sur les différents streams en cours. Elle permet également de rechercher une chaîne Twitch pour accéder aux détails ou au flux vidéo si elle est en train de diffuser du flux.\\
C'est depuis cette vue que l'on peut accéder à la configuration des notifications de chaque chaîne suivis.\\
Lorsque l'on réduit cette fenêtre, elle ne se réduit pas dans la barre de tâche, mais dans la barre de notification. La fermeture de la fenêtre se fait via le menu contextuel de l'icône dans la barre de tâche.
\begin{figure}[h]
\center
\includegraphics[width=0.7\textwidth]{img/vueprincipaletwitch.png}
\caption{Vue principale}
\label{Vue principale 1}
\end{figure}
\begin{enumerate}
\item Affiche toutes les chaîne suivis par l'utilisateur actuellement connecté
\item Affiche les streams populaire actuel de Twitch
\item Connexion à Twitch grâce à une page internet intégrée dans l'application qui s'ouvre lors du clique sur le bouton. Il faut rentrer ses identifiants pour se connecter
\end{enumerate}
\newpage
\begin{figure}[h]
\center
\includegraphics[width=0.7\textwidth]{img/vueprincipalestream.png}
\caption{Vue principale}
\label{Vue principale 2}
\end{figure}


\begin{enumerate}
\item Paramètre sur lequel la recherche va être effectuée
\item Information concernant le stream
\item Champ de saisie pour la recherche
\item Bouton pour accéder à la configuration de la chaine
\item Bouton pour lire le stream depuis l'application
\end{enumerate}

\subsection{Vue d'une notification}
Cette vue apparaît lorsqu'une nouvelle diffusion commence, elle contient toutes les informations concernant la diffusion qui vient de commencer. 
Lorsque l'on clique sur cette vue, la vue des détails d'une chaîne s'ouvre.

\begin{figure}[h]
\center
\includegraphics[width=0.6\textwidth]{img/notificationView.png}
\caption{Vue de la notification}
\label{Vue de notification}
\end{figure}

\newpage
\subsection{Vue détail d'une chaîne}
La vue des détails d'une chaîne permet à l'utilisateur connecté de regarder le flux vidéo diffusé actuellement sur la chaîne Twitch sélectionnée.\\
Toutes les informations concernant la diffusion actuelle ainsi que sur la chaîne en question sont affichées en bas du flux vidéo.\\
La réduction de la fenêtre se fait normalement.

\begin{figure}[h]
\center
\includegraphics[width=1\textwidth]{img/vueChainenum.png}
\caption{Vue des détails d'une chaîne}
\label{Vue de chaîne}
\end{figure}

\begin{enumerate}
\item Logo, nom de la diffusion actuelle, nom de la chaine, nom du jeu, nom de la team(optionnel)
\item Flux vidéo de la chaîne en question
\item Toutes les informations concernant la diffusion actuelle ainsi que toutes les informations de la chaîne en question
\item Petit bouton pour afficher les images de la chaîne (logo, image de profil, image de fond ...) et leurs liens
\item Bouton pour suivre ou ne plus suivre la chaîne Twitch en question, la coche Notification s'affiche uniquement si l'utilisateur suit la chaîne et permet de recevoir ou pas les notifications de cette chaîne. 
\end{enumerate}

\newpage

\subsubsection{Vue de connexion}
La vue de connexion permet à l'utilisateur de se connecter avec un compte Twitch à l'application.

\begin{figure}[h]
\center
\includegraphics[width=0.5\textwidth]{img/viewLogin.png}
\caption{Vue de connexion à Twitch}
\label{Vue de connexion}
\end{figure}

\newpage
\part{Analyse organique}
\section{Diagramme de classe}
\subsection{Model}
Le modèle de mon application contient trois classes : UserModel, NotificationModel et StreamModel.

\begin{figure}[h]
\center
\includegraphics[width=0.6\textwidth]{img/modelDiagram.png}
\caption{Diagramme de classe du modèle}
\label{Diagramme modèle}
\end{figure}

La classe UserModel contient toutes les informations et méthodes propres à un utilisateur.
Quasiment toutes les fonctions de cette classe sont des requêtes HTML envoyée avec la classe "Curl" ou "JsonSerializer".\\
La classe NotificationModel contient les méthodes concernant les notifications.\\
La classe StreamModel contient les méthodes retournant toutes les informations concernant les streams en général. C'est-à-dire que les informations retournées ne dépendent pas de l'utilisateur. 

\newpage
\subsection{Controllers}
\begin{figure}[h]
\center
\includegraphics[width=1\textwidth, angle=90]{img/controllerDiagram.png}
\caption{Diagramme des contrôleurs}
\label{Diagramme contrôleurs}
\end{figure}

\newpage
\subsubsection{Views}
\begin{figure}[h]
\center
\includegraphics[width=1\textwidth, angle=90]{img/viewDiagram.png}
\caption{Diagramme des vues}
\label{Diagramme vues}
\end{figure}

\newpage
\section{API Twitch}
L'API Twitch sert à récupérer les différentes informations d'un flux vidéo sur Twitch et à envoyé des requêtes de modification de compte Twitch\\
Elle utilise un lien URL pour retrouver toutes les informations :  \begin{center}https://api.twitch.tv/kraken/\end{center}
Afin de spécifier quelles informations vont être retourné par l'API, on complète la suite de l'URL. Par exemple, pour retourner les informations d'une chaîne Twitch : \begin{center}https://api.twitch.tv/kraken/channels/[nom de la chaîne Twitch]\end{center}
Toutes les informations que l'API retourne se font depuis cette page et les informations reçues sont formatées en JSON\footnote{JavaScript Object Notation}.

L'API est composé de cette manière :
\begin{itemize}
\item Channels : Informations concernant une chaîne Twitch
\item Chat : Informations concernant le \textit{chat} de la chaîne Twitch
\item Follows : Informations concernant les "suiveurs" de la chaîne Twitch
\item Games : Informations concernant le jeu en cours sur la chaîne Twitch
\item Search : Recherche des streams et des jeux
\item Streams : Informations concernant le stream
\item Subscriptions : Informations concernant les abonnements de la chaîne Twitch
\item Teams : Informations concernant une team sur Twitch
\item Users : Informations concernant un utilisateur
\item Videos : Informations concernant les vidéos de la chaîne Twitchs
\end{itemize}

L'utilisation d'une application Twitch doit être validée sur le compte d'un utilisateur. En effet, avant de pouvoir utiliser un compte Twitch sur une application externe à Twitch, il faut que l'utilisateur autorise cette utilisation.

\subsection{Récupération des données}
Afin de récupérer les données reçues sur la page web de l'API, j'ai créé des classes "type" qui reçoivent les données de Twitch.
\begin{figure}[h]
\center
\includegraphics[width=0.3\textwidth]{img/twitchmodels.png}
\caption{Modèle Twitch}
\label{Modèle Twitch}
\end{figure}
Ces classes ne sont composées que de propriétés et n'ont pas de méthodes, chaque propriété est une donnée reçues depuis l'API. Pour spécifier que cette classe est une classe qui recevra des données sérialisées, il faut spécifier la classe en \textit{"[DataContract]"} et les propriétés en \textit{"[DataMember]"}.\\

\newpage
Pour sérialiser les données reçues, j'ai créé une méthode générique qui retourne un objet de type générique. En effet, il faut spécifier lors de l'appel de la fonction de quel type est le résultat de la requête à l'API.\\
Celle-ci récupère les informations, formatée en JSON, reçues depuis la page web de l'API et les sérialise dans la classe type spécifié lors de l'appel.

\begin{lstlisting}
        /// <summary>
        /// Serialize a Json result
        /// </summary>
        /// <typeparam name="T">Generic type</typeparam>
        /// <param name="url">url for get the result</param>
        /// <returns>variable with a generic type</returns>
        public T Serialize<T>(string url)
        {
            //Create a new generic object
            T obj = default(T);
            try
            {
                WebClient wc = new WebClient();
                //Download the result in a string
                string strJson = wc.DownloadString(url);

                //Serialize the result
                DataContractJsonSerializer js = new DataContractJsonSerializer(typeof(T));
                MemoryStream ms = new MemoryStream(System.Text.UTF8Encoding.Unicode.GetBytes(strJson));
                
                //Read and add to generic object the result
                obj = (T)js.ReadObject(ms);
                ms.Close(); 
            }
            catch(WebException e)
            {
               
            }
            return obj;
        }
\end{lstlisting}


\subsection{OAuth 2.0}
Pour l'authentification d'un utilisateur Twitch sur une application externe, l'API utilise le protocole \textbf{OAuth 2.0}, en effet, ce protocole permet d'obtenir un accès limité à un service via HTTP par le biais d'une autorisation.
La demande d'accès est demandée par le "client", dans notre cas, l'application est le client.\\

OAuth2 définit 4 rôles :
\begin{itemize}
\item Détenteur des données (Nous-même)
\item Serveur de ressources (Twitch)
\item Le client (Twitch Alert)
\item Serveur d'autorisation (Twitch)
\end{itemize}

\noindent
\textbf{Token(jeton)}\\
Lorsque le client fait une demande d'authentification, le serveur d'autorisation délivre un token. Un token permet au serveur de ressources d'autoriser la mise à disposition des données d'un utilisateur. Un token à une durée de vie limité qui est définie par le serveur qui délivre les tokens. Un token doit rester le plus confidentiel possible, même l'utilisateur des ressources ne voit pas le token.\\

\noindent
\textbf{Scope(portée)}\\
Le scope est un paramètre qui sert à définir des droits sur le token. Le serveur d'autorisation propose une liste de scope disponible puis, lors de la demande d'un token, il faut spécifier les scopes à mettre en place.\\

\noindent
\textbf{Type d'autorisation}\\
Il existe deux types d'autorisation, celui qui nous intéresse est : L'autorisation implicite (\textit{Implicit Grant})
L'autorisation implicite s'utilise quand l'application se trouve coté client, ce qui est notre cas.
La demande se fait de la sorte :
\begin{enumerate}
\item L'application souhaite accéder aux données Twitch de votre compte
\item Redirigé dans un navigateur web par l'application vers le serveur d'autorisation
\item Si l'accès est autorisé, le serveur d'autorisation délivre le token et on peut le voir dans l'url.
\item On utilise le token pour faire des appels à l'API de Twitch.
\end{enumerate}

\begin{figure}[h]
\center
\includegraphics[width=0.7\textwidth]{img/SchemaOAuth2.png}
\caption{Schéma 0Auth2 : Droit implicite}
\label{Implicit grant}
\end{figure}

\newpage

\subsection{cURL}
\textbf{C}lient \textbf{URL} \textbf{R}equest \textbf{L}ibrary est une interface en ligne de commande. Elle permet de récupérer des données d'une ressource accessible par réseau. On désigne la ressource à partir d'une URL.

\begin{figure}[h]
\center
\includegraphics[width=1\textwidth]{img/curlExample.png}
\caption{Exemple de requête cURL}
\label{Exemple cURL}

\end{figure}
Ci-dessus un exemple de requête envoyée pour récupérer les données d'une ressource.

Dans notre cas, nous envoyons une requête de type "GET" pour récupérer par exemple les informations d'une chaîne Twitch puis on reçoit les données.\\
L'écriture peut se faire en utilisant les commandes "PUT" ou "POST".\\
Les différents types de requêtes :
\vspace{2mm}
\begin{itemize}
\item GET
\item POST
\item PUT
\item DELETE
\end{itemize}
\vspace{2mm}
Pour envoyer des commandes cURL à la destination souhaitée, j'ai créé une classe permettant de d'envoyer une commande et d'y recevoir la réponse. Afin d'avoir une méthode qui renvoie le bon type suivant la ressource demandée, j'ai utilisé le type générique de C\#.\\
C'est lors de l'appel de la méthode que l'on spécifie de quel type est la valeur de retour.

\begin{lstlisting}
        /// <summary>
        /// Send a request http with cURL
        /// </summary>
        /// <typeparam name="T">Return generic type</typeparam>
        /// <param name="urlRequest">request url</param>
        /// <param name="p_method">method to use</param>
        /// <param name="p_acces_token">access token for authentificated request</param>
        /// <returns></returns>
        public T SendRequest<T>(string urlRequest, string p_method, string p_acces_token)
        {
            try
            {
                //Create a new http request
                var httpWebRequest = (HttpWebRequest)WebRequest.Create(urlRequest);

                //Init the http request
                httpWebRequest.ContentType = "application/json";
                httpWebRequest.Accept = "application/vnd.twitchtv.v3+json";
                httpWebRequest.Method = p_method;
                httpWebRequest.Headers.Add("Authorization: OAuth " + p_acces_token);
                if (p_method == "PUT")
                    httpWebRequest.ContentLength = 0;

                //Create a http response
                var httpResponse = (HttpWebResponse)httpWebRequest.GetResponse();

                //Read the response
                using (var streamReader = new StreamReader(httpResponse.GetResponseStream()))
                {
                    //Add to the generics variable the result
                    T answer = JsonConvert.DeserializeObject<T>(streamReader.ReadToEnd());
                    return answer;
                }
            }
            catch (WebException e)
            {
                return default(T);
            }
        }
\end{lstlisting}

\section{Site d'autorisation et de connexion}
Lorsqu'un utilisateur veut se connecter et ainsi autoriser le compte à utiliser mon application, celui-ci est redirigé vers un site internet. Ce site internet que l'on a accès via : \url{http://froelicher.github.io/TwitchAlert/} a été mis en ligne par moi-même, mais le code a été pris de l'exemple donné par Twitch dans la documentation de OAuth 2.0. \\
C'est également sur ce site que l'on récupère le token dans l'URL.\\

Pour la mise en ligne du site, je me suis servi du service proposé par GitHub : GitHub Pages. Ce service permet d'héberger un site Web sur un dépôt Github et automatiquement, votre site web est en ligne.\\

Pour ne pas s'attarder sur la programmation d'une connexion à Twitch, j'ai utilisé l'exemple donné dans la documentation du SDK JavaScript de Twitch. En effet, elle fournit une page web permettant l'autorisation d'une application sur un compte Twitch et la connexion à Twitch.
\url{https://github.com/justintv/twitch-js-sdk}.

\section{Affichage}
\subsection{Pop-up de notification}
Le composant externe "PopopNotifier" a été utilisé pour afficher un pop-up lorsqu'une nouvelle diffusion commence. Ce composant vient du web : \url{http://www.codeproject.com/Articles/277584/Notification-Window}.\\
Pour rendre le composant plus attrayant et adapté à mon interface homme-machine, j'ai modifié certains éléments graphiques à l'interne du composant.

Les différentes informations affichées : Nom du stream; nom de la chaîne Twitch; nom du jeu; nombre de spectateurs;

\begin{figure}[h]
\center
\includegraphics[width=0.7\textwidth]{img/screenPopup.png}
\caption{Notification de l'application}
\label{Notification popup vue}
\end{figure}


\subsection{Flux vidéo}
L'affichage du flux vidéo à l'intérieur d'une Windows Form ce fait grâce au composant "WebBrowser". En effet, Twitch dispose d'une URL qui affiche uniquement le lecteur de flux vidéo, j'affiche donc le contenu de cette page web dans le WebBrowser, ainsi, je n'ai que le lecteur vidéo.

\newpage
\section{Notification}
\subsection{Vérification de nouveaux streams en ligne}
Afin de vérifier si des streams commencent à diffuser, j'ai mis en place un timer qui va vérifier si un nouveau stream a commencé.
La méthode CheckNewStreamOnline() de la classe NotificationModel sert à vérifier si une nouvelle diffusion en direct commence, elle procède ainsi :

\begin{lstlisting}
        /// <summary>
        /// Check the new online stream
        /// </summary>
        /// <returns>list of new online stream</returns>
        public List<Stream> CheckNewStreamOnline()
        {
			//List of new streams online
            List<Stream> diff = null;

            if(this.StreamOnline != null)
            {
				//Create a new list with the current online streams
                List<Stream> oldStreamOnline = new List<Stream>(this.StreamOnline);
				
				//Update the current online streams
                this.UpdateStreamsOnline();
				
				//Create a new list with the current online streams
                diff = new List<Stream>(this.StreamOnline);
				
				//Compare the two list
                for (int i = 0; i < this.StreamOnline.Count(); i++)
                {
                    for (int j = 0; j < oldStreamOnline.Count(); j++)
                    {
                        if (this.StreamOnline[i]._id == oldStreamOnline[j]._id)
                        {
							//remove if the current stream is in the old list stream
                            diff.Remove(StreamOnline[i]);
                        }
                    }
                }
            }
            else
            {
                this.UpdateStreamsOnline();
            }
            return diff;
        }
\end{lstlisting}

\subsubsection{Multi-Threading}
Le coût en ressources d'un \textit{timer} venant de la vue ralentissait la vue de l'application lors d'um \textit{tick}. Afin de résoudre ce problème, j'ai mis en place un autre timer, celui-ci étant, par défaut lancé dans un autre processus que la vue. De ce fait, chaque fois qu'il y a un tick du timer celui ne ralentit en rien la vue. Car l'événement qui est appelé à chaque tick ne se trouve pas dans le même thread que la vue.

\begin{lstlisting}
//Automaticaly excute in another thread
            this.TimerCheck = new System.Timers.Timer();
            this.TimerCheck.Enabled = true;
            this.TimerCheck.Elapsed += new ElapsedEventHandler(OnTimedEvent);
            this.TimerCheck.Interval = 5000;
\end{lstlisting}

Étant donné que l'affichage sur une vue depuis un autre Thread que celui dans lequel la vue se trouve est impossible, il faut donc encapsuler la méthode qui affiche la notification avec la méthode \textbf{Invoke((MethodInvoker)delegate{});} qui exécute un délégué sur le thread de la vue.

\newpage
\part{Tests}
\section{Tests fonctionnels}
\begin{figure}[h]
\center
\includegraphics[width=1\textwidth]{img/Tests.png}
\caption{Tests fonctionnels}
\label{Tests fonctionnels}
\end{figure}

\newpage
\part{Conclusion}
\section{Apport personnel}
L'estimation de l'apport personnel apporté sur ce projet est :\\
\noindent
La création de la vue est 60\% de moi-même, l'affichage du stream se fait via le WebBrowser, la vue de notification est un composant pris de l'externe où les propriété graphique a été modifié par moi.
La gestion de notification a été faite 100\% par moi.\\
La méthode qui cURL a été faite 100\% par moi.\\
La méthode de désérialisation Json a été faite 100\% par moi.

\section{Conclusion personnelle}
\subsection{Bilan personnel}
J'ai eu plaisir de travailler sur ce projet, le fait de travailler avec une API était nouveau pour moi. De plus, travailler dans un domaine que j'affectionne tout particulièrement m'a permit de trouver une motivation sur la réalisation de ce projet. Le fait que ça soit une application que je pourrai utiliser m'a également motivé.
Sur la gestion du temps, je n'ai malheureusement pas bien réparti le temps de travail tout au long du projet. En effet, la plupart du développement a été réaliser sur la fin du projet. \\
Malgré tout, je suis tout de même satisfait de l'application réalisée même si elle ne remplit pas tout le cahier des charges.
\section{Conclusion technique}
\subsection{Bilan de réalisation}
En terme de réalisation, mon application ne remplit pas le cahier des charges dans son intégralité. La partie de la gestion de notification a été négligée, en effet au fur et à mesure de l'avancement du projet, je trouvais que la gestion des notifications n'avait pas un grand intérêt.
Par contre, une application fonctionnelle a tout de même été réalisé.
\subsection{Améliorations et perspectives}
Une gestion des notifications peut être ajoutée, une gestion mieux pensée que celle proposée dans le cahier des charges.
Une partie "non-connectée" de l'application qui permettrait à des utilisateurs non-connectés à Twitch d'utiliser l'application.

Pour mon travail de diplôme, je dois réaliser une application permettant la gestion des médias du Web. Il est très probable que j'utilise mon application, ou une grande partie des sources pour réaliser mon travail de diplôme.


\part{Annexes}

\subsection{Planification}
\subsubsection{Planification prévisionnelle}
\begin{ganttchart}[hgrid,vgrid,x unit=8mm,y unit chart=6mm,group left shift=0,group right shift=0,group peaks tip position=0,group peaks height=.4]{1}{14}
\gantttitle{\textbf{2014}}{4}
\gantttitle{\textbf{2015}}{10}\ganttnewline
\gantttitle{\textbf{Décembre}}{3}
\gantttitle{\textbf{Janvier}}{4}
\gantttitle{\textbf{Février}}{3}
\gantttitle{\textbf{Mars}}{4}\ganttnewline
\gantttitlelist{3,9,17,6,14,21,28,4,18,25,4,10,18,25}{1}\ganttnewline
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=green}]{Cahier des charges}{1}{1}\ganttnewline
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=green}]{Recherche}{2}{7}\ganttnewline
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=green}]{Analyse fonctionnelle}{2}{6}\ganttnewline
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=green}]{Analyse organique}{6}{8}
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=red}]{}{8}{9}\ganttnewline
\ganttmilestone{Rapport intermédiaire}{7}\ganttnewline
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=red}]{Développement}{8}{12}\ganttnewline
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=red}]{Test+Rapport}{11}{12}\ganttnewline
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=green}]{Documentation}{1}{8}
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=red}]{}{8}{12}\ganttnewline
\ganttmilestone{Rapport final}{13}\ganttnewline
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=red}]{Présentation}{13}{14}
\ganttlink{elem4}{elem5}
\ganttlink{elem5}{elem6}
\ganttlink{elem9}{elem10}
\ganttlink{elem10}{elem11}
\end{ganttchart}

\subsubsection{Planning réel}
\begin{ganttchart}[hgrid,vgrid,x unit=8mm,y unit chart=6mm,group left shift=0,group right shift=0,group peaks tip position=0,group peaks height=.4]{1}{14}
\gantttitle{\textbf{2014}}{4}
\gantttitle{\textbf{2015}}{10}\ganttnewline
\gantttitle{\textbf{Décembre}}{3}
\gantttitle{\textbf{Janvier}}{4}
\gantttitle{\textbf{Février}}{3}
\gantttitle{\textbf{Mars}}{4}\ganttnewline
\gantttitlelist{3,9,17,6,14,21,28,4,18,25,4,10,18,25}{1}\ganttnewline
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=green}]{Cahier des charges}{1}{1}\ganttnewline
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=green}]{Recherche}{2}{7}\ganttnewline
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=green}]{Analyse fonctionnelle}{2}{6}\ganttnewline
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=green}]{Analyse organique}{6}{10}
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=green}]{}{8}{10}\ganttnewline
\ganttmilestone{Rapport intermédiaire}{7}\ganttnewline
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=green}]{Développement}{8}{12}\ganttnewline
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=green}]{Test+Rapport}{12}{12}\ganttnewline
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=green}]{Documentation}{1}{12}
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=green}]{}{8}{12}\ganttnewline
\ganttmilestone{Rapport final}{13}\ganttnewline
\ganttbar[bar height=.6, bar top shift=.2, bar/.append style={fill=green}]{Présentation}{13}{14}
\ganttlink{elem4}{elem5}
\ganttlink{elem5}{elem6}
\ganttlink{elem9}{elem10}
\ganttlink{elem10}{elem11}
\end{ganttchart}

\part{Références}
\listoffigures

\end{document}
